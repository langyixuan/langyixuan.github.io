(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{550:function(t,a,s){"use strict";s.r(a);var n=s(17),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"项目中的常见bug🐞总结-小程序篇"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#项目中的常见bug🐞总结-小程序篇"}},[t._v("#")]),t._v(" 项目中的常见BUG🐞总结（小程序篇）")]),t._v(" "),s("hr"),t._v(" "),s("img",{staticStyle:{zoom:"150%"},attrs:{src:"https://i.loli.net/2021/09/09/QDzws9y17ZTYAXO.png",alt:"bug"}}),t._v(" "),s("p",[t._v("在项目开发过程中，经常会遇到一些奇奇怪怪的BUG😭，导致项目的进度变得很慢。这篇文章总结一下我在开发和学习小程序中中遇到的一些BUG，以及解决方式。")]),t._v(" "),s("h2",{attrs:{id:"一-数组有值但是console-log出来却为空"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一-数组有值但是console-log出来却为空"}},[t._v("#")]),t._v(" （一）数组有值但是console.log出来却为空")]),t._v(" "),s("h3",{attrs:{id:"_1-问题描述"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-问题描述"}},[t._v("#")]),t._v(" 1. 问题描述")]),t._v(" "),s("p",[t._v("今天在做小程序的项目的时候，遇到一个问题。在Page的data中初始化页面数据的时候，将一个数据的初始值设置为一个空数组，想要在onLoad钩子函数中发送请求之后将请求回来的数据赋值给该数据。但是在测试数据的时候，控制台打印该数据时，发送该数据还是一个空数组，但是点开数组时有正确的数据。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://i.loli.net/2021/09/09/eySzPoHn6tGlTZ8.png",alt:"image-20210909100531719"}})]),t._v(" "),s("h3",{attrs:{id:"_2-问题分析"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-问题分析"}},[t._v("#")]),t._v(" 2. 问题分析")]),t._v(" "),s("p",[t._v("在网上查询了该问题的解决方式，得到一个官方的说法是——"),s("code",[t._v("异步后发")]),t._v("得到的问题。")]),t._v(" "),s("p",[t._v("初始化时给该数据赋值为空数组，但是数组中的数据是通过向服务器端发送请求得到的返回数据push到数组中，这个过程是异步执行的。由于是异步，所以后面的console.log()已经开始执行，所以会显示刚开始的初始值空数组，但是当重新点击控制台打印出来的该空数组时，会重新去读取一遍内存中的值然后显示，所以展开空数组后看到了最终的请求结果。")]),t._v(" "),s("h3",{attrs:{id:"_3-解决方式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-解决方式"}},[t._v("#")]),t._v(" 3. 解决方式")]),t._v(" "),s("p",[t._v("(1) 使用async和await将异步改成同步")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("request")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("   "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 发送异步请求")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("(2) 给输出添加延时")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("someData"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("600")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h2",{attrs:{id:"二-微信小程序运行报错-setting-data-field-xxx-to-undefined-is-invalid"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#二-微信小程序运行报错-setting-data-field-xxx-to-undefined-is-invalid"}},[t._v("#")]),t._v(' （二）微信小程序运行报错：“Setting data field “xxx” to undefined is invalid."')]),t._v(" "),s("h3",{attrs:{id:"_1-问题描述-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-问题描述-2"}},[t._v("#")]),t._v(" 1. 问题描述")]),t._v(" "),s("p",[t._v('做小程序项目的时候，发现明明在Page中定义了一个初始数据，但是调试的时候在AppData中却没有显示该数据，而且控制台报错“Setting data field “xxx” to undefined is invalid."（xxx代表定义的那个初始数据）')]),t._v(" "),s("h3",{attrs:{id:"_2-问题分析-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-问题分析-2"}},[t._v("#")]),t._v(" 2. 问题分析")]),t._v(" "),s("p",[t._v('将数据字段“xxx”设置为未定义是无效的。出现这种情况的时候是页面setData "xxx"的时候，没有获取到值，然后就会将undefined给xxx字段，此时默认字段就会变成undefined，那么就会出现这种问题.')]),t._v(" "),s("h3",{attrs:{id:"_3-解决方式-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-解决方式-2"}},[t._v("#")]),t._v(" 3. 解决方式")]),t._v(" "),s("p",[t._v("setData的时候判断获取到的值是否存在，不存在的时候给定一个默认值即可.")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 借助三元表达式")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setData")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    xxx"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" xxx"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" xxx"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h2",{attrs:{id:"三-请求接口报301-需要登陆"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#三-请求接口报301-需要登陆"}},[t._v("#")]),t._v(" (三) 请求接口报301（需要登陆）")]),t._v(" "),s("h3",{attrs:{id:"_1-问题描述-3"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-问题描述-3"}},[t._v("#")]),t._v(" 1. 问题描述")]),t._v(" "),s("p",[t._v("开发音乐小程序的时候，使用网易云音乐的API，在请求"),s("code",[t._v("/likelist?uid=xxxx")]),t._v("这个接口的时候，明明已经把正确的uid参数传入，在浏览器上测试接口时也是正常的。但是在小程序里请求该接口的时候，返回的结果就是"),s("code",[t._v('{msg: "需要登录", code: 301}')]),t._v("。这个问题困扰了我很久，上网查询了一番也没有找到解决方式，实在恼火🤬。最后在我不屑的努力下，找到了这个问题的解决方式🤩")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://i.loli.net/2021/09/17/ExZyQJesmdNvu2c.png",alt:"image-20210917221545838"}})]),t._v(" "),s("h3",{attrs:{id:"_2-问题分析-3"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-问题分析-3"}},[t._v("#")]),t._v(" 2. 问题分析")]),t._v(" "),s("p",[t._v("首先我去看了一下官方接口文档中，是否有该问题的解决方案。发现文档中只是简单的这样说了一下。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://i.loli.net/2021/09/17/7jd2lou4tFv1QpH.png",alt:"image-20210917221735273"}})]),t._v(" "),s("p",[t._v("我的预感告诉我，这个问题多半和cookie有关🍪，果然顺着这个逻辑找到了问题的解决方案。问题在于，小程序开发中我们需要获取到后端给的cookie进行请求验证,但是微信并没有帮我们保存cookie,那么我们要维持会话需要自己来保存cookie,并且请求的时候加上cookie。")]),t._v(" "),s("h3",{attrs:{id:"_3-解决方案"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-解决方案"}},[t._v("#")]),t._v(" 3. 解决方案")]),t._v(" "),s("p",[t._v("(1) 获取登录cookie")]),t._v(" "),s("p",[t._v("在登录请求后读取 返回值的, header的cookie,并本地存储")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//登录请求回来之后,读取res中的cookie")]),t._v("\n wx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setStorageSync")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"loginCookie"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cookie"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("(2) 请求带上cookie")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//创建header ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" header"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nheader "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" \n   "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'content-type'")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'application/x-www-form-urlencoded'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n   "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cookie'")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("wx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getStorageSync")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"loginCookie"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//读取cookie")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//进行请求,一般外层都有一个封装,然后放在公共类里边")]),t._v("\nwx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("request")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  url"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" realURL"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  method"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" method"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  header"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" header"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//传在请求的header里")]),t._v("\n  data"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" datas"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("success")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("res")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//请求成功的处理")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h2",{attrs:{id:"四-访问event-currenttarget-dataset内部数据undefined"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#四-访问event-currenttarget-dataset内部数据undefined"}},[t._v("#")]),t._v(" （四）访问event.currentTarget.dataset内部数据undefined")]),t._v(" "),s("h3",{attrs:{id:"_1-问题描述-4"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-问题描述-4"}},[t._v("#")]),t._v(" 1. 问题描述")]),t._v(" "),s("p",[t._v("今天做小程序，用页面传值时。在wxml文件中利用data-set传递数据，再在相应页面的js文件中通过event.currentTarget.dataset.xxx拿到数据后通过wx.navidateTo路由传参的方式将数据拼接在url上传递给另一个页面。但是一直访问event.currentTarget.dataset.xxx的数据都是undifined.")]),t._v(" "),s("div",{staticClass:"language-html extra-class"},[s("pre",{pre:!0,attrs:{class:"language-html"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("image")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("cover"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("{{item.al.picUrl}}"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("bindtap")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("toSongDetail"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("data-songInfo")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("{{item}}"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),s("h3",{attrs:{id:"_2-问题分析-4"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-问题分析-4"}},[t._v("#")]),t._v(" 2. 问题分析")]),t._v(" "),s("p",[t._v("其实，很简单！那就是"),s("code",[t._v("data")]),t._v("后面的属性名写得不规范！在"),s("code",[t._v("data")]),t._v("后面的属性名是"),s("code",[t._v("不能按照驼峰式")]),t._v("的写法，只要把定义的"),s("code",[t._v("属性名全部换成小写")]),t._v("就没有问题了！")])])}),[],!1,null,null,null);a.default=e.exports}}]);